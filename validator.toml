# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# UNAUTHORITY (UAT) - VALIDATOR CONFIGURATION v1.0
# Sentry Node Architecture: Public Shield + Private Validator Separation
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[validator]
# Validator Node ID (immutable)
node_id = "validator-1"

# Wallet Address (from Genesis Bootstrap)
# ⚠️ CRITICAL: Set via environment variable UAT_VALIDATOR_ADDRESS per node
# Each validator MUST have unique address from genesis_config.json bootstrap_nodes array
# Validator-1 → bootstrap_nodes[0]
# Validator-2 → bootstrap_nodes[1]
# Validator-3 → bootstrap_nodes[2]
address = "${UAT_VALIDATOR_ADDRESS:-UAT3ea85825b3e13862274365118cafed2939fa8947}"

# Private Key Path (stored securely in cold storage)
# ⚠️ CRITICAL: Never commit this file with actual private key to git!
# Use environment variables instead: export UAT_VALIDATOR_PRIVKEY_PATH=/path/to/key
private_key_path = "${UAT_VALIDATOR_PRIVKEY_PATH}"

# Initial Stake (minimum 1000 UAT = 100,000,000,000 VOI)
stake_void = 100000000000  # 1000 UAT

# Enable automatic reward claiming
auto_claim_rewards = true

# Slashing penalties (%)
double_signing_slash = 100      # 100% loss + ban
downtime_slash = 1              # 1% loss per epoch

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SENTRY NODE ARCHITECTURE
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[sentry_public]
# Public facing address (internet-accessible, exposed to P2P network)
listen_addr = "0.0.0.0"
# ⚠️ Set per validator via UAT_SENTRY_PORT env var
# Validator-1 → 30333
# Validator-2 → 30334
# Validator-3 → 30335
listen_port = ${UAT_SENTRY_PORT:-30333}

# Public IP/DNS that peers use to connect
# Can be a domain name or static IP
external_addr = "validator-node-1.ua1.network"
external_port = ${UAT_SENTRY_PORT:-30333}

# Maximum connections from external peers
max_inbound_connections = 64
max_outbound_connections = 32

# DDoS protection settings
connection_timeout_seconds = 30
rate_limit_requests_per_second = 100
ban_duration_minutes = 10

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PRIVATE SIGNER CONNECTION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[signer_private]
# Private connection to Signer Node (NOT exposed to internet)
# Typically runs on localhost or private VPN/Wireguard network
listen_addr = "127.0.0.1"
# ⚠️ Set per validator via UAT_SIGNER_PORT env var
# Validator-1 → 30331
# Validator-2 → 30332
# Validator-3 → 30333
listen_port = ${UAT_SIGNER_PORT:-30331}

# Must be VPN/encrypted tunnel (Noise Protocol Framework)
encryption_enabled = true
encryption_type = "noise_protocol"

# Signer node connection (internal, not public)
# Use private IP, localhost, or Wireguard IP
signer_endpoint = "127.0.0.1:${UAT_SIGNER_PORT:-30331}"

# Authentication: both nodes must share pre-shared key
psk_file_path = "/etc/uat-validator/signer.psk"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# NETWORK CONFIGURATION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[network]
# Bootstrap nodes to connect to
bootstrap_peers = [
  "/ip4/146.59.1.100/tcp/30333/p2p/12D3KooPXXjfDKCKvF5V7aWX1D8pVwVcfF3FRsCYB2gB1M2a2P",
  "/ip4/146.59.1.101/tcp/30333/p2p/12D3KooPYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY",
  "/ip4/146.59.1.102/tcp/30333/p2p/12D3KooPZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ"
]

# P2P Protocol settings
protocol_version = "1.0"
p2p_encryption = "noise_protocol"

# Connection pool settings
max_peers = 128
min_peers = 8
peer_discovery_interval_seconds = 300

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# BLOCK PRODUCTION & CONSENSUS
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[consensus]
# Consensus algorithm (Asynchronous Byzantine Fault Tolerance)
type = "aBFT"

# Block finality parameters
finality_blocks = 1
finality_time_seconds = 3
target_block_time_seconds = 3

# Byzantine threshold (1/3 + 1 nodes)
byzantine_tolerance = 0.33

# Vote parameters
min_votes_required_percentage = 67
vote_timeout_seconds = 5

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# GAS & TRANSACTION FEES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[gas]
# Base gas price (in VOI - smallest unit)
base_price_void = 1000

# Maximum gas per transaction
max_gas_per_tx = 10000000

# Gas used per byte of transaction data
gas_per_byte = 10

# Dynamic fee scaling for spam prevention
dynamic_scaling_enabled = true

# When single address sends >10 tx/sec, multiply gas by 2^n
spam_threshold_tx_per_sec = 10
spam_scaling_factor = 2

# Burn limit per block (prevents PoB abuse per block)
burn_limit_per_block_void = 1000000000

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# DATABASE & STORAGE
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[storage]
# Data directory for blocks and state
data_dir = "./node_data/validator-1"

# Database type
db_backend = "rocksdb"

# Pruning: Keep only recent blocks
prune_blocks_older_than_days = 90
prune_enabled = true

# Snapshot settings
enable_snapshots = true
snapshot_interval_blocks = 10000

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# LOGGING & MONITORING
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[logging]
# Log level: TRACE, DEBUG, INFO, WARN, ERROR
level = "INFO"

# Log format
format = "json"  # or "plain"

# Log file paths
log_dir = "./logs"
log_file = "validator.log"
log_max_size_mb = 100
log_max_backups = 10

# Metrics collection
metrics_enabled = true
metrics_port = 9090
metrics_path = "/metrics"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SECURITY BEST PRACTICES
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# 1. PRIVATE KEY SECURITY:
#    - NEVER commit private key to Git
#    - Use environment variable: export UAT_VALIDATOR_PRIVKEY_PATH=/path/to/key
#    - Store key in cold storage / HSM (Hardware Security Module)
#    - Restrict file permissions: chmod 600
#
# 2. SENTRY NODE ISOLATION:
#    - Public sentry should run on DMZ or separate machine
#    - Private signer should NOT be internet-facing
#    - Use Wireguard/VPN tunnel between sentry and signer
#    - Use Noise Protocol Framework for all P2P encryption
#
# 3. PRE-SHARED KEY (PSK):
#    - Generate: openssl rand -hex 32 > /etc/uat-validator/signer.psk
#    - Share securely with signer node
#    - Rotate periodically
#    - Restrict permissions: chmod 600
#
# 4. FIREWALL:
#    - Port 30333 (sentry public): Allow from 0.0.0.0/0 (rate-limited)
#    - Port 30334 (signer private): Allow ONLY from sentry node IP
#    - All other ports: DENY
#
# 5. MONITORING:
#    - Monitor for double-signing attempts (automatic ban)
#    - Monitor uptime (>95% required, or face 1% slash per epoch)
#    - Alert on stake changes or unusual activity
#    - Keep private key access logs
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
